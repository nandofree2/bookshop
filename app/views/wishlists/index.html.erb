<p style="color: green"><%= notice %></p>

<% content_for :title, "Wishlists" %>

<h1>Wishlists</h1>

<div id="wishlists">
  <div class="row">
    <% @books.each do |book| %>
      <div class="col-md-3 mb-4">
        <div class="card h-100">
          <% if book.cover_image.attached? %>
            <%= image_tag book.cover_image, class: "card-img-top", style: "height: 250px; object-fit: cover;" %>
          <% else %>
            <div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 250px;">
              <span class="text-muted">No Image</span>
            </div>
          <% end %>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title"><%= book.name %></h5>
            <p class="text-muted"><%= book.category.name if book.category %></p>
            <p><%= "⭐" * book.rating.to_i %></p>
            <p><strong>$<%= book.price %></strong></p>
            <span class="badge bg-info"><%= book.flag.humanize %></span>

            <div class="mt-auto">
              <%= link_to "Show", book_path(book), class: "btn btn-sm btn-outline-primary" %>
              <% if user_signed_in?%>
                <% unless Wishlist.find_by(user_id: current_user.id, book_id: book.id ).present?%>
                  <%= button_to "Add Wishlist",book_wishlists_path(book),method: :post,params: { wishlist: { user_id: current_user.id, book_id: book.id } },class: "btn btn-sm btn-outline-secondary" %>
                <% else %>
                  <%= button_to "Remove Wishlist",book_wishlist_path(book,Wishlist.find_by(book: book, user: current_user)),method: :delete,class: "btn btn-sm btn-danger" %>
                <% end %>


              <% end %>

              <% if current_user.role.name == 'admin' %>
                <%= link_to "Edit", edit_book_path(book), class: "btn btn-sm btn-outline-secondary" %>
                <%= link_to "Delete", book_path(book),
                            data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this book?" },
                            class: "btn btn-sm btn-outline-danger" %>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

