<div class="row mb-4">
  <div class="col-md-4">
    <%= image_tag @book.cover_image, class: "img-fluid rounded" if @book.cover_image.attached? %>
  </div>
  <div class="col-md-8">
    <h3><%= @book.name %></h3>
    <p>Category: <%= @book.category&.name %></p>
    <p>Price: $<%= @book.price %></p>
    <p>Rating: <%= "⭐" * @book.rating.to_i %></p>
    <p><span class="badge bg-info"><%= @book.flag.humanize %></span></p>
    <% if user_signed_in? && current_user.role.name == 'admin' %>
      <%= link_to "Edit", edit_book_path(@book), class: "btn btn-warning" %>
    <% end %>
  </div>
</div>

<hr>

<h4>Comments</h4>
<% @comments.each do |comment| %>
  <div class="border p-2 mb-2 rounded">
    <strong><%= comment.user.name %></strong> (<%= comment.user.role.name %>):
    <p><%= comment.content %></p>
    <% if current_user.id == comment.user.id || current_user.role.name == 'admin' %>
      <%= link_to "Delete", book_comment_path(@book, comment), data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this comment?" }, class: "btn btn-sm btn-outline-danger" %>
    <% end %>
  </div>
<% end %>

<% if user_signed_in? %>
  <%= form_with model: [@book, @comment], local: true do |f| %>
    <div class="mb-3">
      <%= f.text_area :content, class: "form-control", placeholder: "Write a comment..." %>
    </div>
    <%= f.submit "Add Comment", class: "btn btn-primary" %>
  <% end %>
<% else %>
  <p>Please <%= link_to "login", new_user_session_path %> to comment.</p>
<% end %>
